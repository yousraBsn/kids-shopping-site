(c=>{EmailTemplatesAdmin={init(){c(document).on("click","#wcf_preview_email",EmailTemplatesAdmin.send_test_email),c(document).on("click",".wcf-ca-switch.wcf-toggle-template-status",EmailTemplatesAdmin.toggle_activate_template),c(document).on("click","#wcf_ca_delete_coupons",EmailTemplatesAdmin.delete_coupons),c(document).on("click","#wcf_ca_export_orders",EmailTemplatesAdmin.export_orders),c(document).on("click","#wcf-export-templates",EmailTemplatesAdmin.export_templates),c(document).on("click",".wcf-export-template",EmailTemplatesAdmin.export_templates),c(document).on("click","#doaction, #doaction2",EmailTemplatesAdmin.handle_bulk_action),c(document).on("click","#wcf-import-templates",EmailTemplatesAdmin.open_import_modal),c(document).on("click",".wcf-ca-modal-close, .wcf-ca-action--cancel",EmailTemplatesAdmin.close_import_modal),c(document).on("submit","#wcf-ca-import-form",EmailTemplatesAdmin.import_templates),c(document).on("change","#wcf-ca-import-file",EmailTemplatesAdmin.handle_file_change),c(document).on("dragover","#wcf-import-modal",EmailTemplatesAdmin.prevent_default),c(document).on("drop","#wcf-import-modal",EmailTemplatesAdmin.handle_file_drop),c(document).on("click",".wcf-ca-remove-file",EmailTemplatesAdmin.reset_import_file),c(document).on("click",".wcar-switch-grid",EmailTemplatesAdmin.toggle_activate_template_on_grid);let e="#wcf_email_discount_type, #wcf_email_discount_amount, #wcf_email_coupon_expiry_date, #wcf_free_shipping_coupon, #wcf_auto_coupon_apply, #wcf_individual_use_only";c(e).closest("tr").toggle(c("#wcf_override_global_coupon").is(":checked")),c(document).on("click","#wcf_override_global_coupon",function(){c(e).closest("tr").fadeToggle(c("#wcf_override_global_coupon").is(":checked"))})},send_test_email(){let e="";e=jQuery("#wp-wcf_email_body-wrap").hasClass("tmce-active")?tinyMCE.get("wcf_email_body").getContent():jQuery("#wcf_email_body").val();var t=c("#wcf_email_subject").val(),a=c("#wcf_send_test_email").val(),o=document.getElementsByName("id")[0].value,i=c("#_wpnonce").val();c(this).next("div.error").remove(),c.trim(e)?c.trim(t)?c.trim(a)?(t={email_subject:t,email_body:e,email_send_to:a,email_template_id:o,action:"wcf_ca_preview_email_send",security:i},c("#wcf_preview_email").css("cursor","wait").attr("disabled",!0),c.post(ajaxurl,t,function(e){c("#mail_response_msg").empty().fadeIn(),(e.success?c("#mail_response_msg").css("color","green").html("<strong> Email has been sent successfully! </strong>"):c("#mail_response_msg").css("color","red").html("<strong> Email sending failed! Please check your SMTP settings!  </a></strong>")).delay(3e3).fadeOut(),c("#wcf_preview_email").css("cursor","").attr("disabled",!1)})):c(this).after('<div class="error-message wcf-ca-error-msg"> You must add your email id! </div>'):c(this).after('<div class="error-message wcf-ca-error-msg"> Email subject is required! </div>'):c(this).after('<div class="error-message wcf-ca-error-msg"> Email body is required! </div>'),c(".wcf-ca-error-msg").delay(2e3).fadeOut()},delete_coupons(){var e;confirm(wcf_ca_localized_vars._confirm_msg)&&(e={action:"wcf_ca_delete_garbage_coupons",security:wcf_ca_localized_vars._delete_coupon_nonce},c(".wcf-ca-spinner").show(),c(".wcf-ca-spinner").addClass("is-active"),c("#wcf_ca_delete_coupons").css("cursor","wait").attr("disabled",!0),c.post(ajaxurl,e,function(e){c(".wcf-ca-response-msg").empty().fadeIn(),e.success&&(c(".wcf-ca-spinner").hide(),c(".wcf-ca-response-msg").css("color","green").html(e.data).delay(5e3).fadeOut()),c("#wcf_ca_delete_coupons").css("cursor","").attr("disabled",!1)}))},export_orders(){confirm(wcf_ca_localized_vars._confirm_msg_export)&&(window.location.href=window.location.search+"&export_data=true&security="+wcf_ca_localized_vars._export_orders_nonce)},export_templates(e,t){e&&e.preventDefault();let a=c(e?e.currentTarget:"#wcf-export-templates");var e=a.data("nonce"),o=a.data("id"),e={action:"wcf_ca_export_email_templates",_wpnonce:e};Array.isArray(t)&&t.length?e.ids=t:void 0!==o&&(e.ids=[o]),c.ajax({url:ajaxurl,method:"POST",dataType:"json",data:e,beforeSend(){"wcf-export-templates"===a.attr("id")&&(a.prop("disabled",!0).text("Exporting..."),c("#wcf-export-spinner").addClass("is-active").show())}}).done(function(e){var e=new Blob([JSON.stringify(e)],{type:"application/json"}),e=window.URL.createObjectURL(e),t=document.createElement("a");t.href=e,t.download="cart_abandonment_email_templates.json",document.body.appendChild(t),t.click(),window.URL.revokeObjectURL(e),t.remove()}).always(function(){"wcf-export-templates"===a.attr("id")&&(a.prop("disabled",!1).text("Export"),c("#wcf-export-spinner").removeClass("is-active").hide())})},handle_bulk_action(e){var t="doaction"===c(e.currentTarget).attr("id")?"#bulk-action-selector-top":"#bulk-action-selector-bottom";"export_email_templates"===c(t).val()&&(e.preventDefault(),(t=c('input[name="id[]"]:checked').map(function(){return c(this).val()}).get()).length)&&EmailTemplatesAdmin.export_templates(null,t)},toggle_activate_template_on_grid(){let t=c(this),e=t.attr("wcf-ca-template-switch"),a="on"===e?"off":"on",o="on"===e?"green":"red";c.post(ajaxurl,{action:"activate_email_templates",id:c(this).attr("id"),state:e,security:wcf_ca_details.email_toggle_button_nonce},function(e){c("#wcf_activate_email_template").val("on"==a?1:0),c(".wcar_tmpl_response_msg").remove(),c("<span class='wcar_tmpl_response_msg'> "+e.data+" </span>").insertAfter(t).delay(2e3).fadeOut().css("color",o)})},toggle_activate_template(){var e=c(this),t="on"===e.attr("wcf-ca-template-switch")?"off":"on";c("#wcf_activate_email_template").val("on"==t?1:0),e.attr("wcf-ca-template-switch",t)},open_import_modal(){c("#wcf-import-modal").show()},close_import_modal(){c("#wcf-import-modal").hide()},import_templates(e){e.preventDefault();var t,e=document.getElementById("wcf-ca-import-file");e.files.length&&((t=new FileReader).onload=function(e){let t=e.target.result;if("string"==typeof t)try{t=JSON.parse(t)}catch(e){return}c.ajax({url:ajaxurl,type:"POST",data:{action:"wcf_ca_import_email_templates",_wpnonce:c('#wcf-ca-import-form [name="_wpnonce"]').val(),templates:JSON.stringify(t)},beforeSend:EmailTemplatesAdmin.show_import_loader}).done(function(){window.location.reload()})},t.readAsText(e.files[0]))},handle_file_change(){var e=this.files[0];e?(c(".wcf-ca-file-name").text(e.name),c(".wcf-ca-file-preview").show()):EmailTemplatesAdmin.reset_import_file()},handle_file_drop(e){EmailTemplatesAdmin.prevent_default(e);var t,e=e.originalEvent.dataTransfer.files;e&&e.length&&((t=document.getElementById("wcf-ca-import-file")).files=e,EmailTemplatesAdmin.handle_file_change.call(t))},prevent_default(e){e.preventDefault(),e.stopPropagation()},reset_import_file(){c("#wcf-ca-import-file").val(""),c(".wcf-ca-file-preview").hide()},show_import_loader(){c("#wcf-ca-import-form .spinner").addClass("is-active").show(),c('#wcf-ca-import-form button[type="submit"]').prop("disabled",!0)}},c(function(){EmailTemplatesAdmin.init()})})(jQuery);